# Архитектура приложения

Приложение реализовано с использованием архитектуры `Feature-Sliced Design` и с соблюдением принципов проектирования `SOLID`. Приложение состоит из слоёв, описанных в документации к архитектуре `Feature-Sliced Design` на [официальном сайте][fsd-site]. Основное отличие в реализации данного приложения от канонической архитектуры `Feature-Sliced Design` состоит в отсутствие слоёв `features` и `processes`. Подробнее об этом будет описано ниже.

1. Слой `app` реализован в директории `src/app`. Он содержит логику, относящуюся ко всему приложению в целом. В этом слое находятся `пройдеры уровня приложения` и глобальное хранилоще `store`, реализованное с использованием библиотек `redux` и `redux-toolkit`. 
Провадеры реализуют принцип Dependency Inversion из методологии SOLID. Они находятся в отдельной директории `src/app/providers` и реализованы в виде `компонентов высшего порядка HOC`. Каждый такой `HOC` находится в своём файле, а все вместе они собираются в `HOC` `withProviders.tsx`. При добавлении нового провайдера уровня приложения следуются выделить под него отдельный файл в `src/app/providers`, а затем подключить его в `withProviders`. В свою очередь `withProviders` оборачивает корневое приложение `App`, которое находится в файле `src/app/App.tsx`.
`Store` находится в директории `src/app/store`. Его конфигурация осуществляется в файле `src/app/store/store.ts`. В директории `src/app/store` находится директория со слайсами стора, каждый из которых предоставляет внешнему коду `reducer` (для подключения к стору) и `"хук"-конструктор адаптера`, с помощью которого модели (о них речь пойдёт ниже) могут подключаться к внешнему хранилищу. Взаимодействие с внешним хранилищем не через адаптер не допускается, т.к. это нарушает принцип Single Responsibility из методологии SOLID.
Пример реализации слайса находится по [ссылке][slice-creation].

2. Слой `entities` реализован в директории `src/entities`. Сущность по своей сути является програмной реализацией объекта реального мира. Сущность инкапсулирует в себе данные, методы для работы с этими данными и компоненты для отображения данных и работы с методами.
В директории `src/entities` находятся директории сущностей, названия которых соответствуют сущности, например, catalog, user и т.д. Каждая сущность состоит из `модели`, которая находится в директории `model` сущности и `отображения`, находящегося в директории `ui` этой же сущности.
`Модель` подключается к хранилищу данных (локальному или глобальному) через `адаптер` и содержит в себе методы и "хуки" для работы с данными и получения данных в компоненте. Подробное описание модели сущности и шагов по её созданию находится в [документе][entity-creation].
`Отображение` представляет собой набор независимых друг от друга (иначе это нарушит принцип `Single Responsibility` из методологии `SOLID`) `react-компонентов`, которые работают с моделью данной сущности. Компоненты получают модель через пропсы. В отдельном компоненте разрешается реализовывать только логику для отображения текущего компонента (например, флаги отображения вложенных компонентов). Вся логика работы сущности должна быть вынесена в модель сущности, а компонент только использует эту модель (подписывается на получение данных из модели, а также используется методы модели в качестве callback-ов).

3. Слой `pages` находится в директории `app/pages` и содержит в себе страницы приложения, которые рендерятся роутером приложения (реализован через `react-router`). Каждая страница должна располагаться в своей директории с названием, отражающим суть находящегося на странице содержимого. Также допускается объединением нескольких страниц в одну директорию, если все эти страницы объединены одной сутью. Если на странице необходимо использовать провайдеры уровня страницы, то их нужно вынести в директорию `providers` с компонентами высшего порядка HOC той страницы, на которой они будут использоваться (по аналогии с провайдерами корневого приложения `App`).
Особняком стоит страница `Routing`, в которой находится конфигурация роутинга приложения. Все остальные страницы должны подключаться в странице `Routing`, которая в свою очередь рендерится основным приложением `App`. Для получения значений роутов следует использовать утилиты создания роутов из `src/shared/utils/getRoutes`.
Страница является верхнеуровневым компонентом, в котором: 
    - создаются модели сущностей;
    - реализуется логика связи разных сущностей между собой;
    - подключаются провайдеры уровня страницы (если таковые необходимы);
    - осуществляется загрузка данных из API при монтировании страницы;
    - находится вёрстка с использованием `компонентов сущностей`, `виджетов` (о них речь пойдёт ниже) и `компонентов общего назначения из uikit`.

4. Слой `widgets` находится в директории `src/widgets` и содержит в себе сущности (модели и компоненты), объединённые общей логикой. В этом плане виджет очень похож на страницу, но в отличие от неё он не рендерится роутером напрямую, а используется страницей вместе с остальными компонентами. По возможности стоит избегать создания виджетов, кроме тех случаев, когда без них невозможно обойтись.

5. Слой `shared` находится в директории `src/shared` и содержит в себе элементы общего назначения. Основными такими элементами являются:
    - `компоненты отображения`, которые находятся в директории `src/shared/ui`. Эти компоненты обычно не содержат никакой логики (являются "глупыми" компонентами) и служат только для отображения данных и callback-ов, полученных через пропсы. Но также такие компоненты могут работать с моделью общего назначения (о ней речь пойдёт ниже). В таком случае компонент подписывается на получение данных из этой модели и также используется методы модели в качестве callback-ов.
    - `модели`, которые находятся в директории `src/shared/model`. Модель общего назначения реализуется по тем же принципам, что и модель сущности, о которой речь шла выше. Они может использоваться любыми компонентами (компонентами общего назначения, виджетами, страницами).
    - `утилиты`, которые находятся в директории `src/shared/utils`. Они содержать в себе функции и хуки, используемые во всём приложении.
    - `дизайн система`, которая находится в директории `src/shared/styles`. В ней находятся основные настройки стилизации приложения, вынесены цвета, типографика, а также вынесены темы приложения. Подробнее о дизайн системе описано в [документе][design-system].
    - `исключения`, которые находятся в директории `src/shared/exceptions`. Они содержат в себе классы создания исключений приложения. Основным исключением является ApiException, которое выбрасывается при неудачном обращении к API.

В текущей архитектуре не реализуются слои `features` и `processes`. Слой `processes` отмечен устаревшим в [официальной документации][fsd-site]. Слой `features` не используется, т.к. вся логика поведения сущности инкапсулируется в модели этой сущности, что делает ненужным выделения ещё одного слоя для этого.

[slice-creation]: <https://github.com/DenRostokin/react-clean-arch>
[design-system]: <https://github.com/DenRostokin/react-clean-arch>
[fsd-site]: <https://feature-sliced.design/ru/docs/get-started/overview>
[entity-creation]: <https://github.com/DenRostokin/react-clean-arch/blob/main/docs/EntityModel.md>
